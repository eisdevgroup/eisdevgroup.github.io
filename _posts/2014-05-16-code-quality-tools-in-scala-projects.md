---
layout: post
title: "Code quality tools in Scala projects"
description: "Инструменты улучшения качества кода в проектах на Scala"
category: code quality
tags: [play, scala, code quality]
---
{% include JB/setup %}

## Инструменты улучшения качества кода в проектах на Scala

Мы занимаемся разработкой на Scala уже порядка года и за это время накопили некоторый инструментарий, чтобы следить за качеством кода, который мы пишем.
В этой статье я постараюсь описать эти инструменты и как мы их используем.

### Инструменты

На данный момет мы используем 3 инструмента:
1. Linter - производит статический анализатор кода;
2. ScalaStyle - производит анализ исходных кодов на предмет соответствия стандарту и прнципам написания кода;
3. JaCoCo - производит оценку покрытия кода тестами.

Ссылки на инструменты приведены в [последнем разделе поста](#links)

### Linter

linter был первым инструментом, который мы включили в проекты.
Да, сообщения scalac и sbt гораздо более информативны и полезны, чем сообщения javac и maven, однако они не позволяют отследить некоторые неприятные моменты в коде.
linter же позволяет отследить участки кода, возможно содержащие ошибки - например места в коде с использованием небезопасных сравнений.

В итоге уже в первую неделю использования linter позволил вычистить большую часть базу кода от подобных опасных выражений и иcправить некоторые замаскированные баги.

### ScalaStyle

ScalaStyle помогает нам следовать стандарту и рекомендациям написания кода на Scala. Это оптимизированный для Scala наследник CodeStyle, разработанного для Java.
После превой проверки кода мы получили огромное количество предупреждений - как безобидных, вроде превышения длины строки кода, так и более неприятных, например магических чисел в коде.
Отчасти в подобных результатах проверки виновата официальная документация PlayFramework, например [здесь](http://www.playframework.com/documentation/2.3.x/ScalaActions) не указываются возвращаемые типы для публичных методов.
Но всетаки большую часть ошибок в оформлении кода допустили мы сами.

Теперь мы более внимательно следим за тем, как мы пишем, и ScalaStyle нам в этом помогает.

### JaCoCo

В сети доступно несколько вариантов со своими приемуществами и недостатками (например [scct](http://mtkopone.github.io/scct/), [scoverage](http://scoverage.org/) ).
Мы остановились на JaCoCo по причине наличия плагина для Jenkins и удобной конфигурации.

### Все в сборе

Чтобы можно было в любой момент получить отчет о результатах проверок кода проектов, мы внедрили процесс проверки в сборку проектов.
В качестве инструмента [CI](http://ru.wikipedia.org/wiki/%D0%9D%D0%B5%D0%BF%D1%80%D0%B5%D1%80%D1%8B%D0%B2%D0%BD%D0%B0%D1%8F_%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F) мы используем [Jenkins]()
После заливки изменнений в коде в центральный репозиторий Jenkins запускает тесты и отдельно запускает проверку стилистики кода, после чего производится сбор статистики и формирование графиков и таблиц.

Статический анализ мы проводим при каждой сборке, как на сервере Jenkins, так и локально на разработческих машинах. Время компиляции увеличивается несущественно, а разработчик сразу получает полезную информацию.
Кроме того разработчик не забывает провести проверку перед отправкой кода в центральный репозиторий, например.

### Полезные ссылки<a name="links"></a>

- [Linter](https://github.com/HairyFotr/linter)
- [ScalaStyle](http://www.scalastyle.org/)
- [JaCoCo](http://www.eclemma.org/jacoco/)
- [JaCoCo sbt plugin](https://github.com/sbt/jacoco4sbt)
- [Jenkins Checkstyle plugin](https://wiki.jenkins-ci.org/display/JENKINS/Checkstyle+Plugin)
- [Jenkins JaCoCo plugin](https://wiki.jenkins-ci.org/display/JENKINS/JaCoCo+Plugin)
